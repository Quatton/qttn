---
import { site } from "@/config/site";
import { type Word } from "@/db/schema";
import Layout from "@/layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import { actions } from "astro:actions";

const id = Astro.params.id as string;
const cookie = Astro.cookies.get(`const:${id}`)?.json();

let words = cookie as Word[];

if (!words) {
  const wds = await Astro.callAction(
    actions.constAction.words.orThrow,
    undefined,
  );
  Astro.cookies.set(`const:${id}`, JSON.stringify(wds), {
    expires: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7),
    path: "/",
    domain: `.${Astro.url.hostname}`,
  });
  words = wds;
}
---

<Layout title="const!">
  <main
    class="h-screen pt-16 container mx-auto flex justify-center items-center"
  >
    <section class="max-w-2xl">
      Use the following words to create a story:

      <div class="flex gap-2 flex-wrap max-w-md justify-center text-xl">
        {
          words.map((word) => (
            <div class="border rounded-full flex items-center gap-2 p-2">
              <div class="dropdown">
                <div
                  tabindex="0"
                  class="btn-xs btn btn-outline btn-error btn-circle"
                >
                  <Icon name="heroicons:x-mark" />
                </div>
                <ul
                  tabindex="0"
                  class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow"
                >
                  <li>
                    <a>Too difficult</a>
                  </li>
                  <li>
                    <a>Is this a word?</a>
                  </li>
                </ul>
              </div>
              {word.name}
            </div>
          ))
        }
      </div>
    </section>
  </main>
</Layout>
